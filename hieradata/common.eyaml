---
# yamllint disable rule:line-length
nginx::package_ensure: '1.14.0-1.el7_4.ngx'
nginx::confd_purge: true
nginx::server_purge: true
nginx::http2: 'on'
# https://mozilla.github.io/server-side-tls/ssl-config-generator/?server=nginx-1.14.0&openssl=1.0.2k&hsts=yes&profile=modern
nginx::ssl_protocols: 'TLSv1.2'
nginx::ssl_ciphers: |
  ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256
nginx::gzip_proxied: 'any'
add_header:
  # 180d is required to get an A+ rating from ssllabs.com
  Strict-Transport-Security: "'max-age=15768000'"
  # openssl x509 -in lsst.codes.pem -pubkey -noout | openssl rsa -pubin -outform der | openssl dgst -sha256 -binary | openssl enc -base64
# alphassl signed *.lsst.codes
ssl_cert: |
  -----BEGIN CERTIFICATE-----
  MIIGVjCCBT6gAwIBAgIMQ2X9JGh5t87Ak5NFMA0GCSqGSIb3DQEBCwUAMEwxCzAJ
  BgNVBAYTAkJFMRkwFwYDVQQKExBHbG9iYWxTaWduIG52LXNhMSIwIAYDVQQDExlB
  bHBoYVNTTCBDQSAtIFNIQTI1NiAtIEcyMB4XDTE4MDcwOTIzMDA0MloXDTE5MTAw
  ODE2MzgwMFowOjEhMB8GA1UECxMYRG9tYWluIENvbnRyb2wgVmFsaWRhdGVkMRUw
  EwYDVQQDDAwqLmxzc3QuY29kZXMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEK
  AoIBAQC7kSLRDrQJ5X8QTx9PQUxBOWMX7Ym10qaq14BStEj6EE6HgqfxxrTpJyGS
  fTtxtD5Jww420qm0PqciuF6TwLgi1ZEtdOph0pxgSG0A8PJ6aMVXRla24iMgNKuV
  jFrR5Cj2MB0S/woifGNe++f61K9/9bFYwBpcYgk71cHune9m6P161ukk+DzhXRy7
  827AiWGaQQC1ECCsFskpo/mOGypMS5nJr6Q9NmpEexyK9qgY/Uq6xRovMZ7RwQA3
  ePPcnBz01/X/n0RqVvZSmPBNpvdbamRhBqAsx1zJ+Lh1rGl71KCZeG+ullg5FMUE
  pwLxz3HfuXYBOnSYDXIwrABlGxK5AgMBAAGjggNIMIIDRDAOBgNVHQ8BAf8EBAMC
  BaAwgYkGCCsGAQUFBwEBBH0wezBCBggrBgEFBQcwAoY2aHR0cDovL3NlY3VyZTIu
  YWxwaGFzc2wuY29tL2NhY2VydC9nc2FscGhhc2hhMmcycjEuY3J0MDUGCCsGAQUF
  BzABhilodHRwOi8vb2NzcDIuZ2xvYmFsc2lnbi5jb20vZ3NhbHBoYXNoYTJnMjBX
  BgNVHSAEUDBOMEIGCisGAQQBoDIBCgowNDAyBggrBgEFBQcCARYmaHR0cHM6Ly93
  d3cuZ2xvYmFsc2lnbi5jb20vcmVwb3NpdG9yeS8wCAYGZ4EMAQIBMAkGA1UdEwQC
  MAAwPgYDVR0fBDcwNTAzoDGgL4YtaHR0cDovL2NybDIuYWxwaGFzc2wuY29tL2dz
  L2dzYWxwaGFzaGEyZzIuY3JsMCMGA1UdEQQcMBqCDCoubHNzdC5jb2Rlc4IKbHNz
  dC5jb2RlczAdBgNVHSUEFjAUBggrBgEFBQcDAQYIKwYBBQUHAwIwHQYDVR0OBBYE
  FJQq/ch3dHuz1XMobE++D+k8HErgMB8GA1UdIwQYMBaAFPXN1TwIUPlqTzq3l9pW
  g+Zp0mj3MIIBfAYKKwYBBAHWeQIEAgSCAWwEggFoAWYAdQCHdb/nWXz4jEOZX73z
  bv9WjUdWNv9KtWDBtOr/XqCDDwAAAWSBRpVgAAAEAwBGMEQCIG9th5yKeiqQuCOD
  MjnvnOfF0ikFhCvjO43qsdhK+x7+AiAi8yLo8oSHUb33hW81LHfQfOi1+mRMnBnW
  WwuNTH+7dgB1AKS5CZC0GFgUh7sTosxncAo8NZgE+RvfuON3zQ7IDdwQAAABZIFG
  lpcAAAQDAEYwRAIgPk/Dv/jPWd5Q+rimpMM9JZAxXUAjfnyDsAXxnu2JS5ACIEv9
  icWmf2EN1R0kyx79fplevlIgXsjYFvZZFfCb8Vr5AHYAb1N2rDHwMRnYmQCkURX/
  dxUcEdkCwQApBo2yCJo32RMAAAFkgUaVnwAABAMARzBFAiEAhZL3yhSjIuZ5AK8H
  ami10y8/D6TG7U+a/qnCfrsCfmcCIBZHoS1AFAYPu14FLqlthvsFJoQ1hZy4KbfF
  ZzjTViQ7MA0GCSqGSIb3DQEBCwUAA4IBAQDAcM12fuklhXtZ/3+sl42iyk7n7KVs
  g6LoRnNruepoBh3czXy+BrisAKIVBwnTztgmWWUIXAgunw1occCY9BnP2PubxHX9
  C4Ag5Fq9XkGG3YjIZBtiBtgp0Z+kFCCJf0dImfzjBa4i65SkImWklbmHysU9JLRk
  5vqUry+JNN34ly2BqrYA9iksIv0tY3HiCW4xKluOUp+C7HX5TpH7tZ6l+FhMR7Px
  yBNGGN1b9PdtryJ1DKQk976D5to0Y1bMrxy3Q89e5JIB387NYDbPFc9l95srHTL+
  FATddckSqyi/QTwmx4xEyeTVAvNW0gThbdXxlSUK8uZNAz+z7kWhKbL/
  -----END CERTIFICATE-----
# alphassl intermediary
ssl_chain_cert: |
  -----BEGIN CERTIFICATE-----
  MIIETTCCAzWgAwIBAgILBAAAAAABRE7wNjEwDQYJKoZIhvcNAQELBQAwVzELMAkG
  A1UEBhMCQkUxGTAXBgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExEDAOBgNVBAsTB1Jv
  b3QgQ0ExGzAZBgNVBAMTEkdsb2JhbFNpZ24gUm9vdCBDQTAeFw0xNDAyMjAxMDAw
  MDBaFw0yNDAyMjAxMDAwMDBaMEwxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9i
  YWxTaWduIG52LXNhMSIwIAYDVQQDExlBbHBoYVNTTCBDQSAtIFNIQTI1NiAtIEcy
  MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA2gHs5OxzYPt+j2q3xhfj
  kmQy1KwA2aIPue3ua4qGypJn2XTXXUcCPI9A1p5tFM3D2ik5pw8FCmiiZhoexLKL
  dljlq10dj0CzOYvvHoN9ItDjqQAu7FPPYhmFRChMwCfLew7sEGQAEKQFzKByvkFs
  MVtI5LHsuSPrVU3QfWJKpbSlpFmFxSWRpv6mCZ8GEG2PgQxkQF5zAJrgLmWYVBAA
  cJjI4e00X9icxw3A1iNZRfz+VXqG7pRgIvGu0eZVRvaZxRsIdF+ssGSEj4k4HKGn
  kCFPAm694GFn1PhChw8K98kEbSqpL+9Cpd/do1PbmB6B+Zpye1reTz5/olig4het
  ZwIDAQABo4IBIzCCAR8wDgYDVR0PAQH/BAQDAgEGMBIGA1UdEwEB/wQIMAYBAf8C
  AQAwHQYDVR0OBBYEFPXN1TwIUPlqTzq3l9pWg+Zp0mj3MEUGA1UdIAQ+MDwwOgYE
  VR0gADAyMDAGCCsGAQUFBwIBFiRodHRwczovL3d3dy5hbHBoYXNzbC5jb20vcmVw
  b3NpdG9yeS8wMwYDVR0fBCwwKjAooCagJIYiaHR0cDovL2NybC5nbG9iYWxzaWdu
  Lm5ldC9yb290LmNybDA9BggrBgEFBQcBAQQxMC8wLQYIKwYBBQUHMAGGIWh0dHA6
  Ly9vY3NwLmdsb2JhbHNpZ24uY29tL3Jvb3RyMTAfBgNVHSMEGDAWgBRge2YaRQ2X
  yolQL30EzTSo//z9SzANBgkqhkiG9w0BAQsFAAOCAQEAYEBoFkfnFo3bXKFWKsv0
  XJuwHqJL9csCP/gLofKnQtS3TOvjZoDzJUN4LhsXVgdSGMvRqOzm+3M+pGKMgLTS
  xRJzo9P6Aji+Yz2EuJnB8br3n8NA0VgYU8Fi3a8YQn80TsVD1XGwMADH45CuP1eG
  l87qDBKOInDjZqdUfy4oy9RU0LMeYmcI+Sfhy+NmuCQbiWqJRGXy2UzSWByMTsCV
  odTvZy84IOgu/5ZR8LrYPZJwR2UcnnNytGAMXOLRc3bgr07i5TelRS+KIz6HxzDm
  MTh89N1SyvNTBCVXVmaU6Avu5gMUTu79bZRknl7OedSyps9AsUSoPocZXun4IRZZUw==
  -----END CERTIFICATE-----
# globalsign root
ssl_root_cert: |
  -----BEGIN CERTIFICATE-----
  MIIDdTCCAl2gAwIBAgILBAAAAAABFUtaw5QwDQYJKoZIhvcNAQEFBQAwVzELMAkG
  A1UEBhMCQkUxGTAXBgNVBAoTEEdsb2JhbFNpZ24gbnYtc2ExEDAOBgNVBAsTB1Jv
  b3QgQ0ExGzAZBgNVBAMTEkdsb2JhbFNpZ24gUm9vdCBDQTAeFw05ODA5MDExMjAw
  MDBaFw0yODAxMjgxMjAwMDBaMFcxCzAJBgNVBAYTAkJFMRkwFwYDVQQKExBHbG9i
  YWxTaWduIG52LXNhMRAwDgYDVQQLEwdSb290IENBMRswGQYDVQQDExJHbG9iYWxT
  aWduIFJvb3QgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDaDuaZ
  jc6j40+Kfvvxi4Mla+pIH/EqsLmVEQS98GPR4mdmzxzdzxtIK+6NiY6arymAZavp
  xy0Sy6scTHAHoT0KMM0VjU/43dSMUBUc71DuxC73/OlS8pF94G3VNTCOXkNz8kHp
  1Wrjsok6Vjk4bwY8iGlbKk3Fp1S4bInMm/k8yuX9ifUSPJJ4ltbcdG6TRGHRjcdG
  snUOhugZitVtbNV4FpWi6cgKOOvyJBNPc1STE4U6G7weNLWLBYy5d4ux2x8gkasJ
  U26Qzns3dLlwR5EiUWMWea6xrkEmCMgZK9FGqkjWZCrXgzT/LCrBbBlDSgeF59N8
  9iFo7+ryUp9/k5DPAgMBAAGjQjBAMA4GA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8E
  BTADAQH/MB0GA1UdDgQWBBRge2YaRQ2XyolQL30EzTSo//z9SzANBgkqhkiG9w0B
  AQUFAAOCAQEA1nPnfE920I2/7LqivjTFKDK1fPxsnCwrvQmeU79rXqoRSLblCKOz
  yj1hTdNGCbM+w6DjY1Ub8rrvrTnhQ7k4o+YviiY776BQVvnGCv04zcQLcFGUl5gE
  38NflNUVyRRBnMRddWQVDf9VMOyGj/8N7yy5Y0b2qvzfvGn9LhJIZJrglfCm7ymP
  AbEVtQwdpf5pLGkkeB6zpxxxYu7KyJesF12KwvhHhm4qxFYxldBniYUr+WymXUad
  DKqC5JlR3XC321Y9YeRq4VzW9v493kHMB65jUr9TU/Qr6cf9tveCX4XSQRjbgbME
  HMUfpIBvFSDJ3gyICh3WZlXi/EjJKSZp4A==
  -----END CERTIFICATE-----
ssl_key: |
  ENC[PKCS7,MIIITQYJKoZIhvcNAQcDoIIIPjCCCDoCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAhBaGKs0/hEkmlUCyyKbZs86pcuf/3twpPLbrMg5u+XTz2bm6bXcckQUn8C4V4oYPqe1o83KZZLDOQXSZ24/dXxUcOuevIDB38mwEXUjkPK4ms7aHOnwlzDVMFOKccabC5S79NQa70ctlI0nn4CPMFejuNw38iVO/tBAPYK7zwcQQbBoOLbWtNNtm28zg0Eeao3P23TCD6XtuN5TNMMLytf5pCcj37AP77iK4Er1xLgexlGLw0EZTXR4Wo4YjTh7XRl/XlOq8Xvon36HoMKsfR1PXW4aIPD4PnQPzVjN97m6Kv7me/cUvN2Nv8/NFYh8j/5nmHEzgNx9WWuR5fOrTkTCCBw4GCSqGSIb3DQEHATAdBglghkgBZQMEASoEEBgbrI5/G2dtK2yIOatU3mCAggbgUiEbci20ivIzG/TfZo4J0RUwd51dLa/7P9Fv5Oo03/02kYj0+KtpRNIILRu6pI0AoCdIaA8XsWSDzBkLF3CWuP4mYWrQ+di+ufUTJfyGpTt4F8K08JhcwX9x+Qk/vDuAR0tEtA93V0JB+ohQs227hxmtSjKcSQqx1nHXYgxLR3C6TTVYb1dILbJcHevlasxVaq4jctnkD8emnSxUQfGNMSWdZ8aQOnGbGPjn3jHCf/SHvo3DyoDR2GQRf7cYmRrZDNpoJMtyRH4fqdWlwk3xdDKg6i4kJ+JXLkMPW1jleRxEBgvJ6EuObGbUII40qIY0p5nhqB+xICXAwjggYItyXTRnqJBdP8ARJDpBXUmEPnvNE1QY/j/bPjlJCsL8L8bxhxtIVpJWOFvsziTuoYxY5Kf7Hz4HTKgezGKAYb2gnZEF2XvYjlNz9FtfKzm2ZXGUFrVtgWmVHs++nnYj8/JjppeUZERRjm9HQOp0xCqkTckbc1XrH0x0ct+B6fd+2GssHvXDpeXuHcesmT19KaItUeGf6tXXe8OCY65ymbypf+bMyWixdeCqbX7loxIGFD4JpBl9pq2xddMPMh16uVH+NCkN8R873RUoC3Xkig6LZDEKfFZEsswVmfPoevMOKs890bsQ+2j3dMvn69mKxv6Ak7emBCDxoxh9vvQDSQGalp351/XgXOTp45H/yL0zRRA2Ximu6GzNoVo7m3sR4RgfgBhP2FPTRss2tT4w+XGxU2te98QcCBBmFNQb5dBBy8ibr+WgcLyB6mprsYhdpwPyzpSfF2rir5mgRhGfW6PyY4vLyn96yFC1Jb45cLVdxXbwgQqZWXFCIZFnIQ2p8dX1cpxJUzNx9H5ncH9p/cxZrA0dsiZZIfWu5t8E0FKHmgUdpEq1KPlo1VIFX10y7tlZBUkjwEE7jFB9Q7btmfiK4AntugsvAXGOYE2OWrQtpUEI46ojoM12cLFqhLtMCgf7n8q6kCrC+xNAoE4HvxRm298ftPKknRgznNA/4rT7eb9AH0SlloNNJPI2ABwWDeYuv6Kv8d8IZQ9UmKV2SUJ9qBEnMvuQaU4RtGON+GjLcfFmHXJ6nI4AHDmoprJrX6BuWqrCJr/31D3t8Qd9BpCq+caaZCaWzaYegwO83iEnTEd6Re/iwEjS4np/GrmxahV1cuXGuqz81frIN8nkT4HX7+22HygyzG13vmfTegXAuNbSyG2jdpFFxUtbQy0KolhMj4Wgm0mPeSpS4d+iQGJexIh6AZBrduvHsHpsA6xF3QmeHdRT6luSn6aQ1aiKsYeN5HuXcZ401qxHcRjJOMhtSsopp9GhTyrJeXaa/UEiXwJZOH29wjjW/+sfPiz93G9r559497S9krBt34hLp7Zl1YhcBj7p1yDIDnVFtE1sL2X/TmSHk52evjwTwnPyVvj/l5GRar/6vWcqNYf+HpQ/8uUz6C6zDH35yxyCi7c87e1ikeZ2KrA/D9o+iQDhdZpI6Y+8Zx34xsPmn6qocYhxJav+Mf2safsYIIMYIaSSHC1GquMswjuxHA0BRl3ntfy8LQOBnm0xXocbhig32thGewEfIi7bXMuJuQ3TucAdX27/2c4d3Oi91MBql0trFS24Rg8YGp9ciGymJMdUqFCiRYsPstiSlDOhx7y8G+K9Q23ZeO0mJUj0XpFI1tmTlAcaF4av1qAwjjaeiUGcXkzsoVPBLZkQtm2tavynqf37lGUv7lT//wxlo/72kx1uQIMoytBmYGaZsKLisbAQXJpE4GQx1eUpFm1sbfOhS3glWJucFAi0qsBT2PKae4ZdJbZHhTHCjTh11RDkWURfF9p7gzOiyIUFj7pxFrxBbGKpfmpCGkGyfOqSXaTN4ieDyDK0Ilwmf1VIA5XaRc8OqQiMMilZr/Q169I5kgfYywGIzRBqW/jNRbFjb9Cjp/oIEU8wa63YbKqN2LEMeuQjtqWNrSdB/tXafndtGEFdu1Ga5CMtm9e/fdG3qFk9KqRC9mR+8pj6Udb2odnTsCUYCwHKmbB0hxPYi1FaCYio8J1IrYqubkMk2YidTGQPm7WSwglI6IRNQglmf+7a1GUNeLoEb79RdptnGi+yTnVazNrjP+KZtmQHGO42F5yzsJMFxa1OUYIr5URlpqMSwGkxIkRyDxCfklXblm8uoLT472DJgoB4mn87IBBzh4wZMqzFNbc7SWUIqks6X6ycXDKcqQxbuKV+is9aDs5syJhcvzF323Zkt+yI3YUzM3cuU8tsGYALz3rcL0BxiWWgpw4oBMsilY2zzbZxDKGAXbJagoK1S9CusH4ihWsQ/ZUKlmB/yXaMIMo1I0xr7ZvdJH5i1kY5ylM=]
docker::version: '18.03.1.ce'
timezone::timezone: 'US/Pacific'
tuned::profile: 'virtual-host'
classes:
  - docker::run_instance
docker::run_instance::instance:
  jenkins-swarm-client:
    image: 'lsstsqre/jenkins-swarm-client:latest'
    volumes:
      - '/j:/j'
      - '/var/run/docker.sock:/var/run/docker.sock'
    extra_parameters:
      - '--restart=always'
    env:
      - JENKINS_SLAVE_MODE=exclusive
      - "MASTER_URL=https://%{::jenkins_fqdn}"
      - LABELS=jenkins-master
      - EXECUTORS=8
      - CLIENT_NAME=jenkins-master
      - FSROOT=/j
      # pipeline scripts will try to restart on a agent based its name; if an
      # agent with an unique id in its name is restarted, it reattaches with a
      # new unique name and the pipeline script hangs forever.
      - DISABLE_CLIENTS_UNIQUE_ID=true
      - DELETE_EXISTING_CLIENTS=true
      # Note  that jenkins very strangely seems to require the `repo` (full)
      # scope in order to process a github personal api token.
      - JENKINS_USERNAME=ENC[PKCS7,MIIBeQYJKoZIhvcNAQcDoIIBajCCAWYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEATH/amp4S5AVwYiNinizYPc5b1vzT+iaG+naAXhVBR7nbTyxja5cIBmyHNtmpxtY8V6cR43QYun5/ssRxFNI4X9cIZyjeUsqDkXgr1ZdSQ0H5mm4opYBoVa6qjZYo4YnxqLEQbakDa2OEmg2K2pDfAE+kSQchLXVKH/YXoRqYMZp+UuNcFDaFs+nK9jaQrVyiI91UEs1jKYG23xNkz72SDJv4NZZF3rV6my0Hk52hLYCq7n/mbiCxv8nF1U6OBYU4WQkEb2VIpVi8m7jsuvUptnKvHgeTy8K/GgxaAe/7P59OWTDAVbGyLc953zm7WBuiLQ97ClYV1yGztahz7iPCrjA8BgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBAWExDzXnaqD+8aa8SSdq/xgBAwldd5IZDQYgsuOapsp9Pg]
      - JENKINS_PASSWORD=ENC[PKCS7,MIIBmQYJKoZIhvcNAQcDoIIBijCCAYYCAQAxggEhMIIBHQIBADAFMAACAQEwDQYJKoZIhvcNAQEBBQAEggEAmZ5HP+cIvG2SUwQI8833zwJADV0GQkNDULQ1lerabdB8+63165iUE2xlB6AdGeTm78WT2Y3kb/eY5Yz+r7x6IpttS6BFZXf3W0JgqJuzb/uo4lin+dSxmWCUBuaRQ3Fk3XgOjzd13SN1S9Sk2S5eV3M+nN/pyzZqHygtveJRwdFj7r6ZcaFcU3rrCMDKVRQ6+7cFL9e6s0qs1lBgr5MHKgpHJUVwLPdJR7t3s6GnAdpaPL7K/DDnlZXNlTolv4Un9Onf1LkP2ek3zeHsgoco0yDe5sy90PBRnkHVdTvuotDn20iJldhlnEJmTM3skvKhZxs1o/fquubxWXomNgc2NjBcBgkqhkiG9w0BBwEwHQYJYIZIAWUDBAEqBBDCCRSorwYhBjeByamqCBfNgDAR+uwQYXy5j14lrEf2jUM3TzvW15FhR2yBh/ZXMBgMlAGskLM4z1rOVEUT3i5yVow=]
  #  masterurl    => $masterurl,
  #  slave_name   => $::hostname,
  #  slave_home   => '/j',
  #  slave_groups => $docker,
  #  slave_mode   => $slave_mode,
  #  executors    => $executors,
  #  labels       => join(delete_undef_values($real_labels), ' '),
